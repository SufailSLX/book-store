<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate">
<meta http-equiv="Pragma" content="no-cache">
<meta http-equiv="Expires" content="0">
    
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined">
    <script src="https://code.iconify.design/iconify-icon/0.0.2/iconify-icon.min.js"></script>
        
<!-- GSAP  -->

<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.11.5/ScrollTrigger.min.js"></script>
        
</head>
<body>
<!-- NAVBAR  -->
 
    <nav class="navbar">
        <h2>Book Cloud</h2>
        <!-- <ul class="nav-links">
            <li><a href="#" class="active">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Books</a></li>
            <li><a href="#">Contact</a></li>
        </ul> -->
        <div class="nav-icons">
            <a href="/api/wishlist" class="wishlist-icon">
                <span class="material-symbols-outlined">favorite</span>
            </a>
            <span id="logoutButton" class="material-symbols-outlined">logout</span>
        </div>

        <!-- <div class="hamburger">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div> -->
    </nav>


    <!-- <button class="logout-btn">
        <span class="material-symbols-outlined">logout</span>
    </button> -->
    <!-- <button id="logoutButton">Logout</button> -->
    
    <div class="line"></div>
    <!-------------------------------------------------------------------------->

<!-- INTRO  -->
    <div class="intro">
        <div class="intro-content">
            <h1 class="intro-title">Welcome to <span>Book Cloud</span></h1>
            <p class="intro-subtitle">Your Gateway to Infinite Stories</p>
            <a href="" class="intro-cta">Explore Now</a>
        </div>
        <div class="intro-img">
            <img src="/assets/intro.gif" alt="intro">
        </div>
    </div>

<!-- ABOUT  -->
<!-------------------------------------------------------------------------->

<!-------------------------------------------------------------------------->
<section class="about-us">
    <div class="about-container">
        <!-- Image Section -->
        <div class="about-image">
            <img src="/assets/logo.png" alt="About Us Image">
        </div>

        <!-- Text Section -->
        <div class="about-text">
            <h2 class="alkatra">About Us</h2>
            <p class="pacifico-regular">At <strong>Book Cloud</strong>, we believe in the transformative power of books. Our mission is to bring the world of literature to your fingertips, anytime, anywhere.</p>

            <!-- Mission Statement -->
            <div class="mission-statement">
                <h3>Our Mission</h3>
                <p>To create a seamless digital reading experience that inspires, educates, and entertains readers of all ages.</p>
            </div>

            <!-- Fun Fact -->
            <div class="fun-fact">
                <h3>Did You Know?</h3>
                <p>The longest novel ever written is <em>Ã€ la recherche du temps perdu</em> by Marcel Proust, with over 1.2 million words!</p>
            </div>
        </div>
    </div>
</section>
<!-------------------------------------------------------------------------->

<!-- Search Bar -->
<!-- <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search books by title or author..." onkeyup="searchBooks()">
    </div> -->

    <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search books by title or author..." onkeyup="searchBooks()">
        <!-- <button class="search-btn">Search</button> -->
    </div>
    
    <!-------------------------------------------------------------------------->
    
    <!-- Book List -->
    <div id="book-list">
        <% books.slice(0, 5).forEach(book => { %>
            <div class="book-card">
                <img src="<%= book.image ? book.image : '/assets/default-book.png' %>" alt="Book Cover">
                <div class="book-details">
                    <strong class="book-title"><%= book.title %></strong>
                    <p class="book-author">by <%= book.author %></p>
                    <p><%= book.description %></p>
                    <div class="book-buttons">
                        <a href="/read/<%= book._id %>" class="read-btn">Click to Read</a>
                        <button class="add-to-wishlist" data-book-id="<%= book._id %>">
                            <span class="material-symbols-outlined">favorite</span>
                        </button>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>

    <div class="pagination-controls">
        <button id="prev-btn" onclick="prevBooks()" disabled>Previous</button>
        <button id="next-btn" onclick="nextBooks()">Next</button>
    </div>


<!-- FOOTER  -->

    <footer class="footer">
        <div class="footer-container">
            <!-- Quick Links -->
            <div class="footer-section">
                <h3>Quick Links</h3>
                <ul>
                    <!-- <li><a href="/">Home</a></li> -->
                    <li><a href="/books">Browse Books</a></li>
                    <li><a href="/about">About Us</a></li>
                    <li><a href="/faq">FAQ</a></li>
                    <li><a href="/privacy-policy">Privacy Policy</a></li>
                </ul>
            </div>
    
            <!-- Contact Us -->
            <div class="footer-section">
                <h3>Contact Us</h3>
                <p>Email: <a href="mailto:webconnect.slx@gmail.com">webconnect.slx@gmail.com</a></p>
                <p>Phone: +1 (123) 456-7890</p>
                <p>Address: 123 Book Street, Knowledge City, Earth</p>
            </div>
    
            <!-- Newsletter Subscription -->
            <div class="footer-section">
                <h3>Subscribe to Our Newsletter</h3>
                <form class="newsletter-form">
                    <input type="email" placeholder="Enter your email" required>
                    <button type="submit">Subscribe</button>
                </form>
                <p>Get the latest updates on new books, promotions, and more!</p>
            </div>
    
            <!-- Social Media Links -->
            <div class="footer-section">
                <h3>Follow Us</h3>
                <div class="social-links">
                    <a href="https://facebook.com/bookstore" target="_blank" aria-label="Facebook"><i class="fa-brands fa-facebook"></i></a>
                    <a href="https://twitter.com/bookstore" target="_blank" aria-label="Twitter"><i class="fa-brands fa-x-twitter"></i></a>
                    <a href="https://instagram.com/bookstore" target="_blank" aria-label="Instagram"><i class="fa-brands fa-square-reddit"></i></a>
                    <a href="https://linkedin.com/bookstore" target="_blank" aria-label="LinkedIn"><i class="fa-brands fa-youtube"></i></a>
                </div>
            </div>
        </div>
    
        <!-- Copyright -->
        <div class="footer-bottom">
            <p>&copy; 2025 Bookstore. All rights reserved.</p>
        </div>
    </footer>



<!-- -------------------------------- -->
    <!-- Toast Notification -->
    <div id="toast" class="toast">Book added to wishlist!</div>

    <script>
        let allBooks = <%- JSON.stringify(books) %>;
        let currentPage = 0;
        const booksPerPage = 3;
        let filteredBooks = [...allBooks]; // Stores filtered books from search

        function renderBooks() {
            let bookList = document.getElementById("book-list");
            bookList.innerHTML = "";
            let start = currentPage * booksPerPage;
            let end = start + booksPerPage;
            let paginatedBooks = filteredBooks.slice(start, end);

            paginatedBooks.forEach(book => {
                let bookHtml = `
                    <div class="book-card">
                        <img src="${book.image ? book.image : '/assets/default-book.png'}" alt="Book Cover">
                        <div class="book-details">
                            <strong class="book-title">${book.title}</strong>
                            <p class="book-author">by ${book.author}</p>
                            <p>${book.description}</p>
                            <div class="book-buttons">
                                <a href="/read/${book._id}" class="read-btn">Click to Read</a>
                                <button class="add-to-wishlist" data-book-id="${book._id}">
                                    <span class="material-symbols-outlined">favorite</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                bookList.innerHTML += bookHtml;
            });

            attachWishlistListeners();
            document.getElementById("prev-btn").disabled = currentPage === 0;
            document.getElementById("next-btn").disabled = end >= filteredBooks.length;
        }

        function nextBooks() {
            if ((currentPage + 1) * booksPerPage < filteredBooks.length) {
                currentPage++;
                renderBooks();
            }
        }

        function prevBooks() {
            if (currentPage > 0) {
                currentPage--;
                renderBooks();
            }
        }

        function searchBooks() {
            let input = document.getElementById("search-bar").value.toLowerCase();
            filteredBooks = allBooks.filter(book => 
                book.title.toLowerCase().includes(input) || 
                book.author.toLowerCase().includes(input)
            );
            currentPage = 0; // Reset to first page
            renderBooks();
        }

        function attachWishlistListeners() {
            document.querySelectorAll(".add-to-wishlist").forEach(button => {
                button.addEventListener("click", async (event) => {
                    const bookId = event.currentTarget.getAttribute("data-book-id");
                    try {
                        const response = await fetch("/api/wishlist/add", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ bookId })
                        });
                        const data = await response.json();
                        if (data.success) {
                            showToast("Book added to wishlist!");
                        } else {
                            showToast("Error: " + data.error, true);
                        }
                    } catch (error) {
                        console.error("Error adding book:", error);
                    }
                });
            });
        }

        function showToast(message, isError = false) {
            let toast = document.getElementById("toast");
            toast.innerText = message;
            toast.style.backgroundColor = isError ? "#D32F2F" : "#4CAF50";
            toast.classList.add("show");

            setTimeout(() => {
                toast.classList.remove("show");
            }, 3000);
        }

           // Logout button functionality
           document.getElementById('logoutButton').addEventListener('click', async () => {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'GET',
                    credentials: 'include' // Include cookies
                });

                if (response.ok) {
                    window.location.href = '/login'; // Redirect to login page
                } else {
                    console.error('Logout failed');
                }
            } catch (error) {
                console.error('Error during logout:', error);
            }
        });

        // Prevent back button after logout
        if (window.history && window.history.pushState) {
            window.history.pushState(null, null, '/api/auth/dashboard');
            window.addEventListener('popstate', function () {
                window.history.pushState(null, null, '/api/auth/dashboard');
            });
        }

         // Prevent caching of the dashboard page
         window.onpageshow = function(event) {
            if (event.persisted) {
                window.location.reload(); // Reload the page if it was restored from the cache
            }
        };

        // Prevent back-button navigation to login page
        history.pushState(null, document.title, location.href);
        window.addEventListener('popstate', function(event) {
            history.pushState(null, document.title, location.href);
        });

        renderBooks();

  
    </script>
    <script src="/js/gsap.js"></script>
</body>
</html>
