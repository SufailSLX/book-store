<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="/css/dashboard.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=search" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=shopping_cart" />
  
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200&icon_names=favorite" />
    <script src="https://code.iconify.design/iconify-icon/0.0.2/iconify-icon.min.js"></script>
</head>
<body>

    <!-- <nav class="navbar">
        <h2>Book Cloud</h2>
        <ul class="nav-links">
            <li><a href="#" class="active">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Books</a></li>
            <li><a href="">Contact</a></li>
        </ul>
        <a href="/api/wishlist" class="wishlist-icon">
            <span class="material-symbols-outlined">favorite</span>
        </a>
    </nav> -->
    <nav class="navbar">
        <h2>Book Cloud</h2>
        <ul class="nav-links">
            <li><a href="#" class="active">Home</a></li>
            <li><a href="#">About</a></li>
            <li><a href="#">Books</a></li>
            <li><a href="#">Contact</a></li>
        </ul>
        <div class="nav-icons">
            <a href="/api/wishlist" class="wishlist-icon">
                <span class="material-symbols-outlined">favorite</span>
            </a>
            <!-- Logout Button -->
            <button class="logout-btn">
                <span class="material-symbols-outlined">logout</span>
            </button>
        </div>
    </nav>

    <div class="line"></div>

    <!-- INTRO -->
    <div class="intro">
        <div class="intro-img">
            <img src="/assets/intro.gif" alt="intro">
        </div>
    </div>

    <!-- ABOUT -->
    <section class="about-us">
        <div class="about-content">
            <h2 class="alkatra">About Us</h2>
            <p class="pacifico-regular">At <strong>Book Cloud</strong>, we believe in the transformative power of books...</p>
        </div>
    </section>

    <div class="search-container">
        <input type="text" id="search-bar" placeholder="Search books by title or author..." onkeyup="searchBooks()">
        <i class="fa-solid fa-search search-icon"></i>
    </div>
    
    <!-- Book List -->
    <div id="book-list">
        <% books.slice(0, 5).forEach(book => { %>
            <div class="book-card">
                <img src="<%= book.image ? book.image : '/assets/default-book.png' %>" alt="Book Cover">
                <div class="book-details">
                    <strong class="book-title"><%= book.title %></strong>
                    <p class="book-author">by <%= book.author %></p>
                    <p><%= book.description %></p>
                    <div class="book-buttons">
                        <a href="/read/<%= book._id %>" class="read-btn">Click to Read</a>
                        <button class="add-to-wishlist" data-book-id="<%= book._id %>">
                            <span class="material-symbols-outlined">favorite</span>
                        </button>
                    </div>
                </div>
            </div>
        <% }); %>
    </div>

    <!-- Navigation Buttons -->
    <div class="pagination-controls">
        <button id="prev-btn" onclick="prevBooks()" disabled>Previous</button>
        <button id="next-btn" onclick="nextBooks()">Next</button>
    </div>

    <!-- FOOTER -->
    <footer class="footer">
        <div class="footer-container">
            <div class="footer-logo">
                <img src="logo.png" alt="Bookstore Logo" class="footer-logo-img">
                <p>Your favorite bookstore for all genres!</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 Bookstore. All rights reserved.</p>
        </div>
    </footer>
    
    <script>
        let allBooks = <%- JSON.stringify(books) %>;
        let currentPage = 0;
        const booksPerPage = 5;

        function renderBooks() {
            let bookList = document.getElementById("book-list");
            bookList.innerHTML = "";
            let start = currentPage * booksPerPage;
            let end = start + booksPerPage;
            let paginatedBooks = allBooks.slice(start, end);

            paginatedBooks.forEach(book => {
                let bookHtml = `
                    <div class="book-card">
                        <img src="${book.image ? book.image : '/assets/default-book.png'}" alt="Book Cover">
                        <div class="book-details">
                            <strong class="book-title">${book.title}</strong>
                            <p class="book-author">by ${book.author}</p>
                            <p>${book.description}</p>
                            <div class="book-buttons">
                                <a href="/read/${book._id}" class="read-btn">Click to Read</a>
                                <button class="add-to-wishlist" data-book-id="${book._id}">
                                    <span class="material-symbols-outlined">favorite</span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                bookList.innerHTML += bookHtml;
            });

            attachWishlistListeners();
            document.getElementById("prev-btn").disabled = currentPage === 0;
            document.getElementById("next-btn").disabled = end >= allBooks.length;
        }

        function nextBooks() {
            if ((currentPage + 1) * booksPerPage < allBooks.length) {
                currentPage++;
                renderBooks();
            }
        }

        function prevBooks() {
            if (currentPage > 0) {
                currentPage--;
                renderBooks();
            }
        }

        function attachWishlistListeners() {
            document.querySelectorAll(".add-to-wishlist").forEach(button => {
                button.addEventListener("click", async (event) => {
                    const bookId = event.target.getAttribute("data-book-id");
                    try {
                        const response = await fetch("/api/wishlist/add", {
                            method: "POST",
                            headers: { "Content-Type": "application/json" },
                            body: JSON.stringify({ bookId })
                        });
                        const data = await response.json();
                        if (data.success) {
                            alert("Book added to wishlist!");
                        } else {
                            alert("Error: " + data.error);
                        }
                    } catch (error) {
                        console.error("Error adding book:", error);
                    }
                });
            });
        }

        function searchBooks() {
            let input = document.getElementById("search-bar").value.toLowerCase();
            let books = document.querySelectorAll(".book-card");

            books.forEach(book => {
                let title = book.querySelector(".book-title").innerText.toLowerCase();
                let author = book.querySelector(".book-author").innerText.toLowerCase();
                book.style.display = (title.includes(input) || author.includes(input)) ? "flex" : "none";
            });
        }

        document.querySelectorAll(".read-btn").forEach(button => {
            button.addEventListener("click", () => {
                window.location.href = button.href; // Ensure navigation happens
            });
        });

        document.querySelector(".logout-btn").addEventListener("click", () => {
    // Perform logout action (e.g., redirect to logout endpoint)
    window.location.href = "/login"; // Replace with your logout endpoint
});

        renderBooks();
    </script>

</body>
</html>
